{% extends "base.html" %} {% block content %}
<div class="flex min-h-screen">
    {% include "/components/index_sidebar.html" %}

    <!-- Main Content -->
    <main class="flex-1 bg-[#1A1A1A] p-8">
        <div class="flex w-3/4 flex-col rounded-md border border-[#383838]">
            <div class="mx-auto w-3/4 bg-[#1A1A1A] p-6">
                {% for schedule in availability.work_schedule %}
                <div class="my-4 flex items-center gap-2">
                    <label class="inline-flex cursor-pointer items-center">
                        <input
                            type="checkbox"
                            name="active"
                            class="peer sr-only"
                            data-schedule-id="{{ loop.index }}"
                            {%
                            if
                            schedule.active
                            %}
                            checked
                            {%
                            endif
                            %}
                            onchange="toggleTimeFields(this, {{ loop.index }}); get_input_value({{ availability.id }});simulateButtonClick();"
                        />
                        <div
                            class="peer relative h-6 w-11 rounded-full bg-[#404040] after:absolute after:start-[2px] after:top-[2px] after:h-5 after:w-5 after:rounded-full after:border after:border-[#1A1A1A] after:bg-[#1A1A1A] after:transition-all after:content-[''] peer-checked:bg-[#E1E1E1] peer-checked:after:translate-x-full peer-checked:after:border-[#1A1A1A] peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:border-gray-600 dark:bg-gray-700 dark:peer-focus:ring-blue-800 rtl:peer-checked:after:-translate-x-full"
                        ></div>
                    </label>

                    <label>
                        <input
                            type="text"
                            name="day_of_week"
                            class="rounded bg-gray-700 px-2 py-1 text-white"
                            value="{{ schedule.day_of_week }}"
                            data-schedule-id="{{ loop.index }}"
                            readonly
                        />
                    </label>
                    <!-- Time fields container -->
                    <div
                        id="time-fields-{{ loop.index }}"
                        class="flex gap-2"
                        {%
                        if
                        not
                        schedule.active
                        %}
                        style="display: none"
                        {%
                        endif
                        %}
                    >
                        <!-- Initially hide if not active -->
                        <label class="inline-flex items-center">
                            <input
                                type="time"
                                name="time_from"
                                value="{{ schedule.time_from }}"
                                class="rounded bg-gray-700 px-2 py-1 text-white"
                                data-schedule-id="{{ loop.index }}"
                            />
                        </label>

                        <span class="text-white">-</span>

                        <label class="inline-flex items-center">
                            <input
                                type="time"
                                name="time_to"
                                value="{{ schedule.time_to }}"
                                class="rounded bg-gray-700 px-2 py-1 text-white"
                                data-schedule-id="{{ loop.index }}"
                            />
                        </label>
                    </div>
                </div>
                {% endfor %}
                <button
                    id="submit-button"
                    onclick="get_input_value({{ availability.id }})"
                    class="my-4 rounded-lg bg-gray-700 px-6 py-2 font-semibold text-white shadow-md transition-all duration-300 hover:bg-blue-600 focus:ring-2 focus:ring-blue-300 active:bg-blue-700"
                >
                    Submit
                </button>
            </div>
        </div>
    </main>
</div>

<script>
    function toggleTimeFields(checkbox, index) {
        const timeFields = document.getElementById(`time-fields-${index}`);
        if (checkbox.checked) {
            timeFields.style.display = "flex";
        } else {
            timeFields.style.display = "none";
        }
    }

    function get_input_value(availabilityId) {
        let data = [];
        let schedules = {};

        document.querySelectorAll("[data-schedule-id]").forEach((element) => {
            let scheduleId = element.getAttribute("data-schedule-id");
            if (!schedules[scheduleId]) {
                schedules[scheduleId] = {};
            }

            switch (element.getAttribute("name")) {
                case "active":
                    schedules[scheduleId].active = element.checked;
                    break;
                case "day_of_week":
                    schedules[scheduleId].day_of_week = element.value;
                    break;
                case "time_from":
                    schedules[scheduleId].time_from = element.value;
                    break;
                case "time_to":
                    schedules[scheduleId].time_to = element.value;
                    break;
            }
        });

        for (let key in schedules) {
            data.push(schedules[key]);
        }

        let url = `/availability_detail/${availabilityId}`;
        console.log(data);

        fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
        })
            .then((response) => response.json())
            .then((data) => {
                console.log("Success:", data);
            })
            .catch((error) => {
                console.error("Error:", error);
            });
    }

    function simulateButtonClick() {
        const button = document.getElementById("submit-button");

        button.classList.add("active:bg-blue-700", "active:scale-95");

        setTimeout(() => {
            button.classList.remove("active:bg-blue-700", "active:scale-95");
        }, 200);
    }
</script>
{% endblock %}
